<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cisco CLI -verkko</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; margin: 0; display: flex; }
    #sidebar { width: 250px; background: #222; padding: 10px; border-right: 2px solid #333; }
    #main { flex-grow: 1; display: flex; flex-direction: column; height: 100vh; }
    #topology { background: #000; color: white; padding: 10px; border-bottom: 1px solid #444; }
    .device { display: inline-block; padding: 10px; margin: 5px; border: 1px solid #0f0; cursor: pointer; }
    #terminal { flex-grow: 1; display: flex; flex-direction: column; padding: 10px; overflow: hidden; }
    #output { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column-reverse; }
    #inputArea { display: flex; }
    #promptText { margin-right: 5px; }
    #commandInput { flex-grow: 1; background: black; color: #0f0; border: none; outline: none; font-size: 1em; }
    .task { margin-bottom: 10px; }
    .done { color: lime; }
    .pending { color: orange; }
  </style>
</head>
<body>
  <div id="sidebar">
    <h3>Tehtävät</h3>
    <div id="tasks"></div>
    <h3>Laitteet</h3>
    <div class="device" onclick="selectDevice('R1')">R1 (reititin)</div>
    <div class="device" onclick="selectDevice('R2')">R2 (reititin)</div>
    <div class="device" onclick="selectDevice('S1')">S1 (switch)</div>
    <div class="device" onclick="selectDevice('PC1')">PC1</div>
  </div>

  <div id="main">
    <div id="topology">
      Topologia: R1 <--> S1 <--> R2 <--> PC1
    </div>

    <div id="terminal">
      <div id="output"></div>
      <div id="inputArea">
        <span id="promptText">R1></span>
        <input type="text" id="commandInput" autocomplete="off" />
      </div>
    </div>
  </div>

  <script>
    const commandInput = document.getElementById('commandInput');
    const output = document.getElementById('output');
    const promptText = document.getElementById('promptText');
    const tasksContainer = document.getElementById('tasks');

    let currentDevice = 'R1';
    let mode = 'exec';
    let currentInterface = null;

    let deviceConfigs = {
      R1: {
        hostname: 'R1',
        interfaces: { 'GigabitEthernet0/1': { ip: null, up: false } }
      },
      R2: {
        hostname: 'R2',
        interfaces: { 'GigabitEthernet0/1': { ip: null, up: false } }
      },
      S1: {
        hostname: 'S1',
        interfaces: { 'FastEthernet0/1': { ip: null, up: false }, 'Vlan1': { ip: '192.168.1.2', up: true } }
      },
      PC1: {
        hostname: 'PC1',
        interfaces: { 'Ethernet0': { ip: '192.168.1.100', up: true } }
      }
    };

    const tasks = [
      { text: 'Anna R1:lle IP osoite Gi0/1:lle ja käynnistä se', check: () => deviceConfigs['R1'].interfaces['GigabitEthernet0/1'].ip && deviceConfigs['R1'].interfaces['GigabitEthernet0/1'].up },
      { text: 'Tarkista onko Vlan1 aktiivinen S1:llä', check: () => deviceConfigs['S1'].interfaces['Vlan1'].up },
      { text: 'Varmista, että PC1:n Ethernet0 on UP', check: () => deviceConfigs['PC1'].interfaces['Ethernet0'].up }
    ];

    function renderTasks() {
      tasksContainer.innerHTML = '';
      tasks.forEach((task, i) => {
        const el = document.createElement('div');
        el.className = 'task';
        const done = task.check() ? 'done' : 'pending';
        el.innerHTML = `• ${task.text} <span class="${done}">${done === 'done' ? 'Valmis' : 'Keskeneräinen'}</span>`;
        tasksContainer.appendChild(el);
      });
    }

    function print(line) {
      const div = document.createElement('div');
      div.textContent = line;
      output.prepend(div);
    }

    function selectDevice(name) {
      currentDevice = name;
      promptText.textContent = `${deviceConfigs[name].hostname}>`;
      mode = 'exec';
      currentInterface = null;
      print(`* Yhdistetty laitteeseen ${name}`);
    }

    commandInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        const input = commandInput.value.trim();
        commandInput.value = '';
        print(`${promptText.textContent} ${input}`);

        const config = deviceConfigs[currentDevice];

        if (input === 'enable') {
          mode = 'enable';
          promptText.textContent = `${config.hostname}#`;
        } else if (input === 'configure terminal' && mode === 'enable') {
          mode = 'config';
          promptText.textContent = `${config.hostname}(config)#`;
        } else if (input.startsWith('interface ') && mode === 'config') {
          const intf = input.split(' ')[1];
          if (config.interfaces[intf]) {
            currentInterface = intf;
            mode = 'interface';
            promptText.textContent = `${config.hostname}(config-if)#`;
          } else {
            print('% Invalid interface');
          }
        } else if (input.startsWith('ip address') && mode === 'interface' && currentInterface) {
          const parts = input.split(' ');
          const ip = parts[2];
          config.interfaces[currentInterface].ip = ip;
          print(`* IP-osoite asetettu: ${ip}`);
        } else if ((input === 'no shutdown' || input === 'no shut') && mode === 'interface' && currentInterface) {
          config.interfaces[currentInterface].up = true;
          print(`* ${currentInterface} aktivoitu`);
        } else if (input === 'exit') {
          if (mode === 'interface') {
            mode = 'config';
            currentInterface = null;
            promptText.textContent = `${config.hostname}(config)#`;
          } else if (mode === 'config') {
            mode = 'enable';
            promptText.textContent = `${config.hostname}#`;
          } else if (mode === 'enable') {
            mode = 'exec';
            promptText.textContent = `${config.hostname}>`;
          }
        } else if (input === 'show ip interface brief') {
          print('Interface\t	IP-Address\tStatus');
          for (const [intf, conf] of Object.entries(config.interfaces)) {
            print(`${intf}\t${conf.ip || 'unassigned'}\t${conf.up ? 'up' : 'administratively down'}`);
          }
        } else if (input === '?') {
          print('Saatavilla komennot:');
          print('- enable, configure terminal, interface, ip address, no shutdown, exit');
          print('- show ip interface brief');
        } else {
          print('% Tuntematon komento');
        }

        renderTasks();
      }
    });

    renderTasks();
  </script>
</body>
</html>
